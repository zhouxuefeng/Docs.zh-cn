---
title: "分部视图"
author: ardalis
description: "在 ASP.NET 核心 MVC 中使用分部视图"
keywords: "ASP.NET 核心，分部视图部分"
ms.author: riande
manager: wpickett
ms.date: 03/14/2017
ms.topic: article
ms.assetid: 4be1b12c-b74e-44ff-826b-99ce86e8d464
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/views/partial
ms.openlocfilehash: 60f5255ca31accbffffec18053b29810977a5ff1
ms.sourcegitcommit: 732cd2684246e49e796836596643a8d37e20c46d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/01/2017
---
# <a name="partial-views"></a><span data-ttu-id="d1e70-104">分部视图</span><span class="sxs-lookup"><span data-stu-id="d1e70-104">Partial Views</span></span>

<span data-ttu-id="d1e70-105">通过[Steve Smith](https://ardalis.com/)， [Maher JENDOUBI](https://twitter.com/maherjend)，和[Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="d1e70-105">By [Steve Smith](https://ardalis.com/), [Maher JENDOUBI](https://twitter.com/maherjend), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="d1e70-106">ASP.NET 核心 MVC 支持分部视图，当您想要不同的视图之间共享的网页的可重用部件时很有用。</span><span class="sxs-lookup"><span data-stu-id="d1e70-106">ASP.NET Core MVC supports partial views, which are useful when you have reusable parts of web pages you want to share between different views.</span></span>

<span data-ttu-id="d1e70-107">[查看或下载的示例代码](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/views/partial/sample)([如何下载](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d1e70-107">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/views/partial/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-are-partial-views"></a><span data-ttu-id="d1e70-108">分部视图有哪些？</span><span class="sxs-lookup"><span data-stu-id="d1e70-108">What are Partial Views?</span></span>

<span data-ttu-id="d1e70-109">分部视图是另一个视图中呈现的视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-109">A partial view is a view that is rendered within another view.</span></span> <span data-ttu-id="d1e70-110">通过执行分部视图生成的 HTML 输出呈现到调用 （或父） 视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-110">The HTML output generated by executing the partial view is rendered into the calling (or parent) view.</span></span> <span data-ttu-id="d1e70-111">分部视图和视图一样使用*.cshtml*文件扩展名。</span><span class="sxs-lookup"><span data-stu-id="d1e70-111">Like views, partial views use the *.cshtml* file extension.</span></span>

## <a name="when-should-i-use-partial-views"></a><span data-ttu-id="d1e70-112">何时应使用分部视图？</span><span class="sxs-lookup"><span data-stu-id="d1e70-112">When Should I Use Partial Views?</span></span>

<span data-ttu-id="d1e70-113">分部视图是分解成较小组件的大视图的有效方法。</span><span class="sxs-lookup"><span data-stu-id="d1e70-113">Partial views are an effective way of breaking up large views into smaller components.</span></span> <span data-ttu-id="d1e70-114">它们可以减少重复查看内容，并允许重复使用的视图元素。</span><span class="sxs-lookup"><span data-stu-id="d1e70-114">They can reduce duplication of view content and allow view elements to be reused.</span></span> <span data-ttu-id="d1e70-115">常见的布局元素应指定在[_Layout.cshtml](layout.md)。</span><span class="sxs-lookup"><span data-stu-id="d1e70-115">Common layout elements should be specified in [_Layout.cshtml](layout.md).</span></span> <span data-ttu-id="d1e70-116">非布局可重用内容可以封装到分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-116">Non-layout reusable content can be encapsulated into partial views.</span></span>

<span data-ttu-id="d1e70-117">如果你有几个逻辑部分组成的复杂页，它可以帮助使用其自己的分部视图为每个段。</span><span class="sxs-lookup"><span data-stu-id="d1e70-117">If you have a complex page made up of several logical pieces, it can be helpful to work with each piece as its own partial view.</span></span> <span data-ttu-id="d1e70-118">页上的其余部分分开，可以查看每个页片段，因为它仅包含的整体页结构和调用来呈现分部视图为页本身的视图变得简单得多。</span><span class="sxs-lookup"><span data-stu-id="d1e70-118">Each piece of the page can be viewed in isolation from the rest of the page, and the view for the page itself becomes much simpler since it only contains the overall page structure and calls to render the partial views.</span></span>

<span data-ttu-id="d1e70-119">提示： 按照[不重复自己原则](http://deviq.com/don-t-repeat-yourself/)在您的视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-119">Tip: Follow the [Don't Repeat Yourself Principle](http://deviq.com/don-t-repeat-yourself/) in your views.</span></span>

## <a name="declaring-partial-views"></a><span data-ttu-id="d1e70-120">声明分部视图</span><span class="sxs-lookup"><span data-stu-id="d1e70-120">Declaring Partial Views</span></span>

<span data-ttu-id="d1e70-121">分部视图创建与其他视图类似： 创建*.cshtml*文件内*视图*文件夹。</span><span class="sxs-lookup"><span data-stu-id="d1e70-121">Partial views are created like any other view: you create a *.cshtml* file within the *Views* folder.</span></span> <span data-ttu-id="d1e70-122">分部视图和常规视图之间没有语义差异-它们只是以不同的方式呈现。</span><span class="sxs-lookup"><span data-stu-id="d1e70-122">There is no semantic difference between a partial view and a regular view - they are just rendered differently.</span></span> <span data-ttu-id="d1e70-123">你可以直接从控制器的返回的视图`ViewResult`，和可以为分部视图使用相同的视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-123">You can have a view that is returned directly from a controller's `ViewResult`, and the same view can be used as a partial view.</span></span> <span data-ttu-id="d1e70-124">如何呈现的视图和分部视图之间的主要区别是分部视图不要运行*_ViewStart.cshtml* (时视图-详细了解*_ViewStart.cshtml*中[布局](layout.md)).</span><span class="sxs-lookup"><span data-stu-id="d1e70-124">The main difference between how a view and a partial view are rendered is that partial views do not run *_ViewStart.cshtml* (while views do - learn more about *_ViewStart.cshtml* in [Layout](layout.md)).</span></span>

## <a name="referencing-a-partial-view"></a><span data-ttu-id="d1e70-125">引用了分部视图</span><span class="sxs-lookup"><span data-stu-id="d1e70-125">Referencing a Partial View</span></span>

<span data-ttu-id="d1e70-126">在视图页中，有几种方法可以在其中呈现了分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-126">From within a view page, there are several ways in which you can render a partial view.</span></span> <span data-ttu-id="d1e70-127">若要使用的是最简单`Html.Partial`，它将返回`IHtmlString`，并且可以通过将调用具有引用`@`:</span><span class="sxs-lookup"><span data-stu-id="d1e70-127">The simplest is to use `Html.Partial`, which returns an `IHtmlString` and can be referenced by prefixing the call with `@`:</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Home/About.cshtml?range=9)]

<span data-ttu-id="d1e70-128">`PartialAsync`方法对于分部视图包含异步代码 （尽管在视图中的代码通常不鼓励） 是可用：</span><span class="sxs-lookup"><span data-stu-id="d1e70-128">The `PartialAsync` method is available for partial views containing asynchronous code (although code in views is generally discouraged):</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Home/About.cshtml?range=8)]

<span data-ttu-id="d1e70-129">你可以呈现具有的分部视图`RenderPartial`。</span><span class="sxs-lookup"><span data-stu-id="d1e70-129">You can render a partial view with `RenderPartial`.</span></span> <span data-ttu-id="d1e70-130">此方法不返回结果;流式处理直接响应呈现的输出。</span><span class="sxs-lookup"><span data-stu-id="d1e70-130">This method doesn't return a result; it streams the rendered output directly to the response.</span></span> <span data-ttu-id="d1e70-131">因为它不返回结果，它必须调用在 Razor 代码块中 (你还可以调用`RenderPartialAsync`如有必要):</span><span class="sxs-lookup"><span data-stu-id="d1e70-131">Because it doesn't return a result, it must be called within a Razor code block (you can also call `RenderPartialAsync` if necessary):</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Home/About.cshtml?range=10-12)]

<span data-ttu-id="d1e70-132">因为它直接，流式处理结果`RenderPartial`和`RenderPartialAsync`可能在某些情况下更好地执行。</span><span class="sxs-lookup"><span data-stu-id="d1e70-132">Because it streams the result directly, `RenderPartial` and `RenderPartialAsync` may perform better in some scenarios.</span></span> <span data-ttu-id="d1e70-133">但是，在大多数情况下，建议你使用`Partial`和`PartialAsync`。</span><span class="sxs-lookup"><span data-stu-id="d1e70-133">However, in most cases it's recommended you use `Partial` and `PartialAsync`.</span></span>

> [!NOTE]
> <span data-ttu-id="d1e70-134">如果你的视图需要执行代码，建议的模式是使用[视图组件](view-components.md)而不是分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-134">If your views need to execute code, the recommended pattern is to use a [view component](view-components.md) instead of a partial view.</span></span>

### <a name="partial-view-discovery"></a><span data-ttu-id="d1e70-135">分部视图发现</span><span class="sxs-lookup"><span data-stu-id="d1e70-135">Partial View Discovery</span></span>

<span data-ttu-id="d1e70-136">当引用了分部视图，您可以参考以下几种方式其位置：</span><span class="sxs-lookup"><span data-stu-id="d1e70-136">When referencing a partial view, you can refer to its location in several ways:</span></span>

```text
// Uses a view in current folder with this name
// If none is found, searches the Shared folder
@Html.Partial("ViewName")

// A view with this name must be in the same folder
@Html.Partial("ViewName.cshtml")

// Locate the view based on the application root
// Paths that start with "/" or "~/" refer to the application root
@Html.Partial("~/Views/Folder/ViewName.cshtml")
@Html.Partial("/Views/Folder/ViewName.cshtml")

// Locate the view using relative paths
@Html.Partial("../Account/LoginPartial.cshtml")
```

<span data-ttu-id="d1e70-137">你可以具有相同名称的不同分部视图不同视图文件夹中。</span><span class="sxs-lookup"><span data-stu-id="d1e70-137">You can have different partial views with the same name in different view folders.</span></span> <span data-ttu-id="d1e70-138">当按名称 （不带文件扩展名） 引用视图，每个文件夹中的视图将与它们位于同一文件夹中使用分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-138">When referencing the views by name (without file extension), views in each folder will use the partial view in the same folder with them.</span></span> <span data-ttu-id="d1e70-139">你还可以指定默认的分部视图，若要使用，将其放在*共享*文件夹。</span><span class="sxs-lookup"><span data-stu-id="d1e70-139">You can also specify a default partial view to use, placing it in the *Shared* folder.</span></span> <span data-ttu-id="d1e70-140">共享的分部视图将使用由任何没有其自己版本的分部视图的视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-140">The shared partial view will be used by any views that don't have their own version of the partial view.</span></span> <span data-ttu-id="d1e70-141">你可以有一个默认分部视图 (在*共享*)，该方法由具有与父视图相同的文件夹中的相同名称的部分视图重写。</span><span class="sxs-lookup"><span data-stu-id="d1e70-141">You can have a default partial view (in *Shared*), which is overridden by a partial view with the same name in the same folder as the parent view.</span></span>

<span data-ttu-id="d1e70-142">可以是分部视图*链接*。</span><span class="sxs-lookup"><span data-stu-id="d1e70-142">Partial views can be *chained*.</span></span> <span data-ttu-id="d1e70-143">也就是说，分部视图可以调用另一个分部视图 （只要你不创建循环）。</span><span class="sxs-lookup"><span data-stu-id="d1e70-143">That is, a partial view can call another partial view (as long as you don't create a loop).</span></span> <span data-ttu-id="d1e70-144">在每个视图或分部视图中，相对路径始终是相对于该视图，而不是根或父视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-144">Within each view or partial view, relative paths are always relative to that view, not the root or parent view.</span></span>

> [!NOTE]
> <span data-ttu-id="d1e70-145">如果你声明[Razor](razor.md) `section`在分部视图中，它将看不到其父对象; 它将被限制为分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-145">If you declare a [Razor](razor.md) `section` in a partial view, it will not be visible to its parent(s); it will be limited to the partial view.</span></span>

## <a name="accessing-data-from-partial-views"></a><span data-ttu-id="d1e70-146">从分部视图访问数据</span><span class="sxs-lookup"><span data-stu-id="d1e70-146">Accessing Data From Partial Views</span></span>

<span data-ttu-id="d1e70-147">当实例化了分部视图时，它将获取父视图的一份`ViewData`字典。</span><span class="sxs-lookup"><span data-stu-id="d1e70-147">When a partial view is instantiated, it gets a copy of the parent view's `ViewData` dictionary.</span></span> <span data-ttu-id="d1e70-148">对分部视图内的数据所做的更新不会保留到父视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-148">Updates made to the data within the partial view are not persisted to the parent view.</span></span> <span data-ttu-id="d1e70-149">`ViewData`更改的分部视图在分部视图返回时丢失。</span><span class="sxs-lookup"><span data-stu-id="d1e70-149">`ViewData` changed in a partial view is lost when the partial view returns.</span></span>

<span data-ttu-id="d1e70-150">你可以将传递的实例`ViewDataDictionary`对分部视图：</span><span class="sxs-lookup"><span data-stu-id="d1e70-150">You can pass an instance of `ViewDataDictionary` to the partial view:</span></span>

```csharp
@Html.Partial("PartialName", customViewData)
   ```

<span data-ttu-id="d1e70-151">此外可以将模型传递到了分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-151">You can also pass a model into a partial view.</span></span> <span data-ttu-id="d1e70-152">这可以是页面的视图模型某一部分或自定义对象。</span><span class="sxs-lookup"><span data-stu-id="d1e70-152">This can be the page's view model, or some portion of it, or a custom object.</span></span> <span data-ttu-id="d1e70-153">你可以将模型传递到`Partial`，`PartialAsync`， `RenderPartial`，或`RenderPartialAsync`:</span><span class="sxs-lookup"><span data-stu-id="d1e70-153">You can pass a model to `Partial`,`PartialAsync`, `RenderPartial`, or `RenderPartialAsync`:</span></span>

```csharp
@Html.Partial("PartialName", viewModel)
   ```

<span data-ttu-id="d1e70-154">你可以将传递的实例`ViewDataDictionary`和分部视图到视图模型：</span><span class="sxs-lookup"><span data-stu-id="d1e70-154">You can pass an instance of `ViewDataDictionary` and a view model to a partial view:</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Articles/Read.cshtml?range=15-16)]

<span data-ttu-id="d1e70-155">下面显示的标记*Views/Articles/Read.cshtml*视图，其中包含两个分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-155">The markup below shows the *Views/Articles/Read.cshtml* view which contains two partial views.</span></span> <span data-ttu-id="d1e70-156">第二个分部视图将在模型中传递和`ViewData`对分部视图。</span><span class="sxs-lookup"><span data-stu-id="d1e70-156">The second partial view passes in a model and `ViewData` to the partial view.</span></span> <span data-ttu-id="d1e70-157">你可以将新传递`ViewData`同时保留现有的字典`ViewData`如果使用的构造函数重载`ViewDataDictionary`下面突出显示：</span><span class="sxs-lookup"><span data-stu-id="d1e70-157">You can pass new `ViewData` dictionary while retaining the existing `ViewData` if you use the constructor overload of the `ViewDataDictionary` highlighted below:</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Articles/Read.cshtml)]

<span data-ttu-id="d1e70-158">*视图/共享/AuthorPartial*:</span><span class="sxs-lookup"><span data-stu-id="d1e70-158">*Views/Shared/AuthorPartial*:</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Shared/AuthorPartial.cshtml)]

<span data-ttu-id="d1e70-159">*ArticleSection*部分：</span><span class="sxs-lookup"><span data-stu-id="d1e70-159">The *ArticleSection* partial:</span></span>

[!code-html[Main](partial/sample/src/PartialViewsSample/Views/Articles/ArticleSection.cshtml)]

<span data-ttu-id="d1e70-160">在运行时，它们将呈现到父视图中，呈现其本身内共享*_Layout.cshtml*</span><span class="sxs-lookup"><span data-stu-id="d1e70-160">At runtime, the partials are rendered into the parent view, which itself is rendered within the shared *_Layout.cshtml*</span></span>

![分部视图输出](partial/_static/output.png)
